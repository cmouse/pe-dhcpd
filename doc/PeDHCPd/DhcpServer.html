<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: PeDHCPd::DhcpServer
  
    &mdash; Documentation by YARD 0.8.7.3
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../PeDHCPd.html" title="PeDHCPd (module)">PeDHCPd</a></span></span>
     &raquo; 
    <span class="title">DhcpServer</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: PeDHCPd::DhcpServer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">PeDHCPd::DhcpServer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/pe-dhcpd.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call_hook-instance_method" title="#call_hook (instance method)">- (Object) <strong>call_hook</strong>(type, msg) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#giaddr2yiaddr-instance_method" title="#giaddr2yiaddr (instance method)">- (Object) <strong>giaddr2yiaddr</strong>(addr, mask) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#guess_my_ip-instance_method" title="#guess_my_ip (instance method)">- (Object) <strong>guess_my_ip</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (DhcpServer) <strong>initialize</strong>(ip) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of DhcpServer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#request2reply-instance_method" title="#request2reply (instance method)">- (Object) <strong>request2reply</strong>(msg, type, flags) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Object) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_options-instance_method" title="#set_options (instance method)">- (Object) <strong>set_options</strong>(msg) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="PeDHCPd::DhcpServer (class)">DhcpServer</a></span></tt>) <strong>initialize</strong>(ip) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns a new instance of DhcpServer
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 29</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_ip identifier id'>ip</span><span class='rparen token'>)</span>
  <span class='rubyid_ip identifier id'>ip</span> <span class='assign token'>=</span> <span class='rubyid_guess_my_ip identifier id'>guess_my_ip</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_ip identifier id'>ip</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
  <span class='rubyid_@ip ivar id'>@ip</span> <span class='assign token'>=</span> <span class='rubyid_ip identifier id'>ip</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="call_hook-instance_method">
  
    - (<tt>Object</tt>) <strong>call_hook</strong>(type, msg) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 106</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_call_hook identifier id'>call_hook</span><span class='lparen token'>(</span><span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='rubyid_msg identifier id'>msg</span><span class='rparen token'>)</span>
  <span class='rubyid_HOOKS constant id'>HOOKS</span><span class='lbrack token'>[</span><span class='rubyid_type identifier id'>type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_hook identifier id'>hook</span><span class='bitor op'>|</span>
     <span class='rubyid_if if kw'>if</span> <span class='rubyid_hook identifier id'>hook</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span> <span class='eq op'>==</span> <span class='rubyid_Class constant id'>Class</span> 
         <span class='rubyid_return return kw'>return</span> <span class='rubyid_false false kw'>false</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_hook identifier id'>hook</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='dot token'>.</span><span class='rubyid_process identifier id'>process</span><span class='lparen token'>(</span><span class='rubyid_msg identifier id'>msg</span><span class='rparen token'>)</span>
     <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_hook identifier id'>hook</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span> <span class='eq op'>==</span> <span class='rubyid_Proc constant id'>Proc</span>
         <span class='rubyid_return return kw'>return</span> <span class='rubyid_false false kw'>false</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_hook identifier id'>hook</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_msg identifier id'>msg</span><span class='rparen token'>)</span>
     <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_hook identifier id'>hook</span><span class='dot token'>.</span><span class='rubyid_respond_to? fid id'>respond_to?</span> <span class='symbol val'>:process</span>
         <span class='rubyid_return return kw'>return</span> <span class='rubyid_false false kw'>false</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_hook identifier id'>hook</span><span class='dot token'>.</span><span class='rubyid_process identifier id'>process</span><span class='lparen token'>(</span><span class='rubyid_msg identifier id'>msg</span><span class='rparen token'>)</span>
     <span class='rubyid_else else kw'>else</span>
         <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_fatal identifier id'>fatal</span> <span class='dstring node'>&quot;#{type.class} is not a Class or Hook, nor does it have process(msg)&quot;</span>
     <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_true true kw'>true</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="giaddr2yiaddr-instance_method">
  
    - (<tt>Object</tt>) <strong>giaddr2yiaddr</strong>(addr, mask) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 81</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_giaddr2yiaddr identifier id'>giaddr2yiaddr</span><span class='lparen token'>(</span><span class='rubyid_addr identifier id'>addr</span><span class='comma token'>,</span> <span class='rubyid_mask identifier id'>mask</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_addr identifier id'>addr</span><span class='dot token'>.</span><span class='rubyid_odd? fid id'>odd?</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_mask identifier id'>mask</span><span class='dot token'>.</span><span class='rubyid_to_bits identifier id'>to_bits</span> <span class='eq op'>==</span> <span class='integer val'>30</span><span class='rparen token'>)</span> <span class='rubyid_or or kw'>or</span> <span class='lparen token'>(</span><span class='rubyid_not not kw'>not</span> <span class='rubyid_addr identifier id'>addr</span><span class='dot token'>.</span><span class='rubyid_odd? fid id'>odd?</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_mask identifier id'>mask</span><span class='dot token'>.</span><span class='rubyid_to_bits identifier id'>to_bits</span> <span class='eq op'>==</span> <span class='integer val'>31</span><span class='rparen token'>)</span>
    <span class='rubyid_addr identifier id'>addr</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='lbrack token'>[</span><span class='integer val'>31</span><span class='comma token'>,</span> <span class='integer val'>30</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span> <span class='rubyid_mask identifier id'>mask</span><span class='dot token'>.</span><span class='rubyid_to_bits identifier id'>to_bits</span>
    <span class='rubyid_addr identifier id'>addr</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_addr identifier id'>addr</span> <span class='opasgn op'>+=</span> <span class='rubyid_YIADDR_POLICY constant id'>YIADDR_POLICY</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="guess_my_ip-instance_method">
  
    - (<tt>Object</tt>) <strong>guess_my_ip</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 34</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_guess_my_ip identifier id'>guess_my_ip</span>
  <span class='rubyid_UDPSocket constant id'>UDPSocket</span><span class='dot token'>.</span><span class='rubyid_open identifier id'>open</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_s identifier id'>s</span><span class='bitor op'>|</span> <span class='rubyid_s identifier id'>s</span><span class='dot token'>.</span><span class='rubyid_connect identifier id'>connect</span><span class='lparen token'>(</span><span class='string val'>&quot;8.8.8.8&quot;</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='semicolon token'>;</span> <span class='rubyid_s identifier id'>s</span><span class='dot token'>.</span><span class='rubyid_addr identifier id'>addr</span><span class='dot token'>.</span><span class='rubyid_last identifier id'>last</span> <span class='rbrace token'>}</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="request2reply-instance_method">
  
    - (<tt>Object</tt>) <strong>request2reply</strong>(msg, type, flags) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 92</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_request2reply identifier id'>request2reply</span><span class='lparen token'>(</span><span class='rubyid_msg identifier id'>msg</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='rubyid_flags identifier id'>flags</span><span class='rparen token'>)</span>
  <span class='rubyid_reply identifier id'>reply</span> <span class='assign token'>=</span> <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>
  <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_op identifier id'>op</span> <span class='assign token'>=</span> <span class='rubyid_BootPacket constant id'>BootPacket</span><span class='colon2 op'>::</span><span class='rubyid_REPLY constant id'>REPLY</span>
  <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_flags identifier id'>flags</span> <span class='assign token'>=</span> <span class='rubyid_flags identifier id'>flags</span>
  <span class='rubyid_reply identifier id'>reply</span> <span class='assign token'>=</span> <span class='rubyid_set_options identifier id'>set_options</span><span class='lparen token'>(</span><span class='rubyid_reply identifier id'>reply</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_YIADDR_POLICY_30_OR_31_MASK constant id'>YIADDR_POLICY_30_OR_31_MASK</span>
    <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_yiaddr identifier id'>yiaddr</span> <span class='assign token'>=</span> <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_yiaddr identifier id'>yiaddr</span> <span class='assign token'>=</span> <span class='rubyid_giaddr2yiaddr identifier id'>giaddr2yiaddr</span><span class='lparen token'>(</span><span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span><span class='comma token'>,</span> <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_get_option identifier id'>get_option</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_reply identifier id'>reply</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='assign token'>=</span> <span class='rubyid_type identifier id'>type</span>
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_reply identifier id'>reply</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    - (<tt>Object</tt>) <strong>run</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 121</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_run identifier id'>run</span>
  <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;TDC DHCP started - Binding to #{@ip}:67&quot;</span>
  
   <span class='comment val'># socket code</span>
  <span class='rubyid_BasicSocket constant id'>BasicSocket</span><span class='dot token'>.</span><span class='rubyid_do_not_reverse_lookup identifier id'>do_not_reverse_lookup</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
  <span class='rubyid_@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='rubyid_UDPSocket constant id'>UDPSocket</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='rubyid_setsockopt identifier id'>setsockopt</span><span class='lparen token'>(</span><span class='rubyid_Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='rubyid_SOL_SOCKET constant id'>SOL_SOCKET</span><span class='comma token'>,</span> <span class='rubyid_Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='rubyid_SO_REUSEADDR constant id'>SO_REUSEADDR</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='rubyid_@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='rubyid_bind identifier id'>bind</span><span class='lparen token'>(</span><span class='rubyid_@ip ivar id'>@ip</span><span class='comma token'>,</span> <span class='integer val'>67</span><span class='rparen token'>)</span>
  
  <span class='comment val'># drop privs</span>
  <span class='rubyid_Process constant id'>Process</span><span class='colon2 op'>::</span><span class='rubyid_Sys constant id'>Sys</span><span class='dot token'>.</span><span class='rubyid_setresgid identifier id'>setresgid</span><span class='lparen token'>(</span><span class='integer val'>99</span><span class='comma token'>,</span><span class='integer val'>99</span><span class='comma token'>,</span><span class='integer val'>99</span><span class='rparen token'>)</span>
  <span class='rubyid_Process constant id'>Process</span><span class='colon2 op'>::</span><span class='rubyid_Sys constant id'>Sys</span><span class='dot token'>.</span><span class='rubyid_setresuid identifier id'>setresuid</span><span class='lparen token'>(</span><span class='integer val'>99</span><span class='comma token'>,</span><span class='integer val'>99</span><span class='comma token'>,</span><span class='integer val'>99</span><span class='rparen token'>)</span>
  
  <span class='comment val'># generate MacFilter</span>
  <span class='rubyid_filter identifier id'>filter</span> <span class='assign token'>=</span> <span class='rubyid_MacFilterList constant id'>MacFilterList</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_BLACKLIST_MACS constant id'>BLACKLIST_MACS</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_mac identifier id'>mac</span><span class='bitor op'>|</span>
    <span class='rubyid_filter identifier id'>filter</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_mac identifier id'>mac</span>
  <span class='rubyid_end end kw'>end</span> 
  
  <span class='rubyid_loop identifier id'>loop</span> <span class='rubyid_do do kw'>do</span> 
    <span class='rubyid_read_array identifier id'>read_array</span> <span class='assign token'>=</span> <span class='rubyid_Kernel constant id'>Kernel</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrack token'>[</span><span class='rubyid_@socket ivar id'>@socket</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='integer val'>10</span>
    <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_read_array identifier id'>read_array</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span> 
       <span class='comment val'># process message</span>
       <span class='rubyid_begin begin kw'>begin</span>
          <span class='rubyid_data identifier id'>data</span><span class='comma token'>,</span> <span class='rubyid_addr identifier id'>addr</span> <span class='assign token'>=</span> <span class='rubyid_@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='rubyid_recvfrom identifier id'>recvfrom</span><span class='lparen token'>(</span><span class='integer val'>1500</span><span class='rparen token'>)</span>
          <span class='rubyid_imsg identifier id'>imsg</span> <span class='assign token'>=</span> <span class='rubyid_BootPacket constant id'>BootPacket</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_data identifier id'>data</span><span class='rparen token'>)</span>
       <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
          <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='dstring node'>&quot;Processing error: #{e}\n#{e.backtrace.join(&quot;\n&quot;)}&quot;</span>
          <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='string val'>&quot;Dumping message packet for debug&quot;</span>
          <span class='rubyid_str identifier id'>str</span> <span class='assign token'>=</span> <span class='rubyid_data identifier id'>data</span><span class='dot token'>.</span><span class='rubyid_bytes identifier id'>bytes</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_c identifier id'>c</span><span class='bitor op'>|</span> <span class='string val'>&quot;%02x&quot;</span> <span class='mod op'>%</span> <span class='lbrack token'>[</span><span class='rubyid_c identifier id'>c</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
          <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='rubyid_str identifier id'>str</span>
          <span class='rubyid_next next kw'>next</span>
       <span class='rubyid_end end kw'>end</span>
  
       <span class='rubyid_if if kw'>if</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_valid? fid id'>valid?</span> <span class='eq op'>==</span> <span class='rubyid_false false kw'>false</span>
         <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='assign token'>=</span> <span class='rubyid_MessageTypeOption constant id'>MessageTypeOption</span><span class='colon2 op'>::</span><span class='rubyid_REQUEST constant id'>REQUEST</span>
       <span class='rubyid_end end kw'>end</span>
  
       <span class='rubyid_if if kw'>if</span> <span class='rubyid_filter identifier id'>filter</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_chaddr identifier id'>chaddr</span> 
         <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Ignoring DHCP from #{imsg.chaddr_s} due to blacklist&quot;</span>
         <span class='rubyid_next next kw'>next</span>
       <span class='rubyid_end end kw'>end</span>
  
       <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Received #{imsg.type.type_s} from #{imsg.ciaddr_s} #{imsg.chaddr_s} via #{imsg.giaddr_s}&quot;</span>
       <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
  
       <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span> <span class='assign token'>=</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_ciaddr identifier id'>ciaddr</span><span class='minus op'>-</span><span class='integer val'>1</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_ciaddr identifier id'>ciaddr</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
  
       <span class='rubyid_if if kw'>if</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span> <span class='eq op'>==</span> <span class='integer val'>0</span> 
         <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='string val'>&quot;Cannot handle packet with no giaddr&quot;</span>
         <span class='rubyid_next next kw'>next</span>
       <span class='rubyid_end end kw'>end</span>
  
       <span class='rubyid_case case kw'>case</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_MessageTypeOption constant id'>MessageTypeOption</span><span class='colon2 op'>::</span><span class='rubyid_DISCOVER constant id'>DISCOVER</span>
            <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_call_hook identifier id'>call_hook</span><span class='lparen token'>(</span><span class='symbol val'>:discover</span><span class='comma token'>,</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='rparen token'>)</span>
            <span class='rubyid_omsg identifier id'>omsg</span> <span class='assign token'>=</span> <span class='rubyid_request2reply identifier id'>request2reply</span><span class='lparen token'>(</span><span class='rubyid_imsg identifier id'>imsg</span><span class='comma token'>,</span> <span class='rubyid_MessageTypeOption constant id'>MessageTypeOption</span><span class='colon2 op'>::</span><span class='rubyid_OFFER constant id'>OFFER</span><span class='comma token'>,</span> <span class='integer val'>0x8000</span><span class='rparen token'>)</span>
            <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_call_hook identifier id'>call_hook</span><span class='lparen token'>(</span><span class='symbol val'>:offer</span><span class='comma token'>,</span> <span class='rubyid_omsg identifier id'>omsg</span><span class='rparen token'>)</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_MessageTypeOption constant id'>MessageTypeOption</span><span class='colon2 op'>::</span><span class='rubyid_REQUEST constant id'>REQUEST</span>
            <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_call_hook identifier id'>call_hook</span><span class='lparen token'>(</span><span class='symbol val'>:request</span><span class='comma token'>,</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='rparen token'>)</span>
            <span class='rubyid_omsg identifier id'>omsg</span> <span class='assign token'>=</span> <span class='rubyid_request2reply identifier id'>request2reply</span><span class='lparen token'>(</span><span class='rubyid_imsg identifier id'>imsg</span><span class='comma token'>,</span> <span class='rubyid_MessageTypeOption constant id'>MessageTypeOption</span><span class='colon2 op'>::</span><span class='rubyid_ACK constant id'>ACK</span><span class='comma token'>,</span> <span class='rubyid_imsg identifier id'>imsg</span><span class='dot token'>.</span><span class='rubyid_flags identifier id'>flags</span><span class='rparen token'>)</span>
            <span class='rubyid_next next kw'>next</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_call_hook identifier id'>call_hook</span><span class='lparen token'>(</span><span class='symbol val'>:acknowledge</span><span class='comma token'>,</span> <span class='rubyid_omsg identifier id'>omsg</span><span class='rparen token'>)</span>
          <span class='rubyid_else else kw'>else</span>
            <span class='rubyid_next next kw'>next</span>
       <span class='rubyid_end end kw'>end</span>
  
       <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span> <span class='dstring node'>&quot;Sending #{omsg.type.type_s} to #{imsg.yiaddr_s} #{imsg.chaddr_s} via #{imsg.giaddr_s}&quot;</span>
       <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='rubyid_omsg identifier id'>omsg</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span>
  
       <span class='comment val'># send the packet back where it came from</span>
       <span class='rubyid_@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='rubyid_send identifier id'>send</span> <span class='rubyid_omsg identifier id'>omsg</span><span class='dot token'>.</span><span class='rubyid_pack identifier id'>pack</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_addr identifier id'>addr</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_addr identifier id'>addr</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_options-instance_method">
  
    - (<tt>Object</tt>) <strong>set_options</strong>(msg) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/pe-dhcpd.rb', line 38</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_options identifier id'>set_options</span><span class='lparen token'>(</span><span class='rubyid_msg identifier id'>msg</span><span class='rparen token'>)</span>
  <span class='rubyid_requested identifier id'>requested</span> <span class='assign token'>=</span> <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_get_option identifier id'>get_option</span><span class='lparen token'>(</span><span class='integer val'>55</span><span class='rparen token'>)</span>
  
  <span class='comment val'># kill parameter request list and requested ip address</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_remove_option identifier id'>remove_option</span><span class='lparen token'>(</span><span class='integer val'>55</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_remove_option identifier id'>remove_option</span><span class='lparen token'>(</span><span class='integer val'>50</span><span class='rparen token'>)</span>
  
  <span class='comment val'># overwrite/add required options</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_YIADDR_POLICY_30_OR_31_MASK constant id'>YIADDR_POLICY_30_OR_31_MASK</span>
     <span class='rubyid_if if kw'>if</span> <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span><span class='dot token'>.</span><span class='rubyid_odd? fid id'>odd?</span>
        <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_SubnetMaskOption constant id'>SubnetMaskOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'255.255.255.252'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
     <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_SubnetMaskOption constant id'>SubnetMaskOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'255.255.255.254'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
     <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_else else kw'>else</span>
     <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_SubnetMaskOption constant id'>SubnetMaskOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_SUBNET_MASK constant id'>SUBNET_MASK</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_RouterOption constant id'>RouterOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_IPAddr constant id'>IPAddr</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_giaddr identifier id'>giaddr</span><span class='comma token'>,</span> <span class='rubyid_Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='rubyid_AF_INET constant id'>AF_INET</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_DomainNameServerOption constant id'>DomainNameServerOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_DNS_SERVERS constant id'>DNS_SERVERS</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_IPAddressLeaseTimeOption constant id'>IPAddressLeaseTimeOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_LEASE_TIME constant id'>LEASE_TIME</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_NetworkTimeProtocolServersOption constant id'>NetworkTimeProtocolServersOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_NTP_SERVERS constant id'>NTP_SERVERS</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_RebindingTimeValueOption constant id'>RebindingTimeValueOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_REBIND_TIME constant id'>REBIND_TIME</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_RenewalTimeValueOption constant id'>RenewalTimeValueOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_RENEWAL_TIME constant id'>RENEWAL_TIME</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_set_option identifier id'>set_option</span><span class='lparen token'>(</span><span class='rubyid_DHCPServerIdentifierOption constant id'>DHCPServerIdentifierOption</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_@ip ivar id'>@ip</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  
  <span class='comment val'># kill anything that wasn't on parameter request list</span>
  <span class='rubyid_unless unless kw'>unless</span> <span class='rubyid_requested identifier id'>requested</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
     <span class='rubyid_new_options identifier id'>new_options</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
     <span class='rubyid_keep identifier id'>keep</span> <span class='assign token'>=</span> <span class='rubyid_requested identifier id'>requested</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='integer val'>51</span><span class='comma token'>,</span><span class='integer val'>53</span><span class='comma token'>,</span><span class='integer val'>54</span><span class='comma token'>,</span><span class='integer val'>60</span><span class='comma token'>,</span><span class='integer val'>61</span><span class='comma token'>,</span><span class='integer val'>82</span><span class='rbrack token'>]</span>
     <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_option identifier id'>option</span><span class='bitor op'>|</span>
       <span class='comment val'># retain messagetypeoption even if it was not asked for...</span>
       <span class='rubyid_if if kw'>if</span> <span class='rubyid_keep identifier id'>keep</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_key identifier id'>key</span><span class='rparen token'>)</span> 
         <span class='rubyid_new_options identifier id'>new_options</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_option identifier id'>option</span>
       <span class='rubyid_else else kw'>else</span> 
         <span class='rubyid_Vars constant id'>Vars</span><span class='dot token'>.</span><span class='rubyid_log identifier id'>log</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;Dropping #{option.class} as it's not wanted&quot;</span>
       <span class='rubyid_end end kw'>end</span>
     <span class='rubyid_end end kw'>end</span>
     <span class='rubyid_msg identifier id'>msg</span><span class='dot token'>.</span><span class='rubyid_options identifier id'>options</span> <span class='assign token'>=</span> <span class='rubyid_new_options identifier id'>new_options</span>
  <span class='rubyid_end end kw'>end</span>
  
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_msg identifier id'>msg</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Jan 13 16:56:10 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-1.8.7).
</div>

  </body>
</html>